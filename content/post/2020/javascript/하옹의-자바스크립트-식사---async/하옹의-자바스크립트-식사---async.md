---
title: 'í•˜ì˜¹ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹ì‚¬ - Asynchronous Programming'
draft: false
date: '2021-01-21'
category: 'javascript'
tags: ['javascript', 'ë¹„ë™ê¸°', 'asynchronous', 'promise', 'async/await', 'callback hell']
---

\* ì´ ê¸€ì€ [Vanilla Coding](https://www.vanillacoding.co/) - BootCamp 9ê¸° 1ì£¼ì°¨ ê°•ì˜ ìˆ˜ê°• í›„ ì ì€ ê¸€ì…ë‹ˆë‹¤.

## Asynchronous?

ì›¹ í”„ë¡ íŠ¸, ë°±ì—”ë“œì™€ ë”ë¶ˆì–´ ëª¨ë“  ê³³ì—ì„œ Javascript(node.js)ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ë¹¼ë†“ì„ ìˆ˜ ì—†ëŠ” ê²ƒì´ ë˜ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì¼ ê²ƒì´ë‹¤.

> íŠ¹íˆ, ì›¹ ë¸Œë¼ìš°ì €ì™€ ìë°”ìŠ¤í¬ë¦½íŠ¸ì— ìˆì–´ì„œ ì´ ë¹„ë™ê¸° ê°œë…ì„ ì´í•´í•˜ëŠ” ê²ƒì´ ìƒë‹¹íˆ ì¤‘ìš”í•˜ë‹¤.

Asynchronous(ë¹„ë™ê¸°)ëŠ” ì–´ë–¤ ì‘ì—… í•œë²ˆì— í•˜ë‚˜ì”© í•´ê²°ì´ ë ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ë©° ìˆœì°¨ì (Synchronous)ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ì¼ë°˜ì ì¸ í”„ë¡œê·¸ë¨ì˜ ì½”ë“œì™€ëŠ” ë‹¤ë¥´ê²Œ,
ì–´ë–¤ ì‘ì—…ì„ ë³„ë„ë¡œ ì§„í–‰ì‹œí‚¤ê³  ì‘ì—…ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë‹¤ìŒì‘ì—…ì„ ì´ì–´ë‚˜ê°€ë©´ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì§„í–‰ì‹œí‚¨ ì‘ì—… ë³„ë„ë¡œ ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´ ê·¸ì œì„œì•¼ ì²˜ë¦¬í•´ì£¼ëŠ” ë°©ì‹ì´ë‹¤.

![ë™ê¸°ì™€ ë¹„ë™ê¸°ë°©ì‹](./sync-async.png)

ìœ„ ì´ë¯¸ì§€ëŠ” [Poiemaweb-async](https://poiemaweb.com/js-async) ê¸€ì—ì„œ ì°¸ì¡°í•œ ê·¸ë¦¼ì¸ë°,
ë™ê¸°(Synchronous)ì™€ ë¹„ë™ê¸°(Asynchronous)ì˜ ê°œë…ì„ ê·¸ë¦¼í•˜ë‚˜ë¡œ ì˜ ì„¤ëª…í•˜ê³  ìˆë‹¤.

ë™ê¸°ëŠ” ìœ„ ì²˜ëŸ¼ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•˜ë©´ ë©”ë‰´ê°€ ë‚˜ì˜¬ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ê³  ë°›ì•„ê°€ëŠ” ë°©ì‹ì´ë¼ë©´,

ë¹„ë™ê¸°ëŠ” ì•„ë˜ ì²˜ëŸ¼ ë©”ë‰´ë¥¼ ì£¼ë¬¸í•˜ê³  ì¤„(Context)ì—ì„œ ë¹ ì ¸ë‚˜ì™€ ë©”ë‰´ê°€ ë‚˜ì˜¬ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦¬ê³ , ë©”ë‰´ê°€ ë‚˜ì˜¤ë©´(ê²°ê³¼ê°€ ë‚˜ì˜¤ë©´) ì£¼ë¬¸í•œ ë©”ë‰´ë¥¼ ë°›ì•„ê°€ëŠ”(ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ”) ë°©ì‹ì´ë‹¤.
ì—¬ê¸°ì„œ, ì¤„ì—ì„œ ë¹ ì ¸ë‚˜ì˜¨ë‹¤ë¼ëŠ” ê°œë…ì€ ë’¤ì´ì–´ ì¤„ ì„  ì‚¬ëŒì´ ì£¼ë¬¸(í˜¹ì€ ë‹¤ë¥¸ ì‘ì—…)ì„ í•  ìˆ˜ ìˆê²Œ ëœë‹¤ëŠ” ëœ»ì´ë©° ë§ˆì°¬ê°€ì§€ë¡œ ì£¼ë¬¸ì´ ëë‚¬ë‹¤ë©´ ê¸°ë‹¤ë¦¬ì§€ì•Šê³  ì£¼ë¬¸ì„ ë„£ê³  ì¤„ì—ì„œ ë¹ ì ¸ë‚˜ê°€ ê¸°ë‹¤ë¦¬ê²Œëœë‹¤.

> ê·¼ë°, Javascript í™˜ê²½ì˜ íŠ¹ì„±ìƒ ì¤„ (javascriptí™˜ê²½ì—ì„œëŠ” `Context` í˜¹ì€ `Call Stack`) ì´ ëª¨ë‘ ë¹„ì›Œì§„ ìƒíƒœì—ì„œ, ê°ê° ì£¼ë¬¸(ë¹„ë™ê¸° í˜¸ì¶œì„ í•œ ì‚¬ëŒ(ì‘ì—…)ë“¤ì—ê²Œ ë©”ë‰´ë¥¼ ì „ë‹¬ í•  ìˆ˜ ìˆë‹¤.
>
> <br>
>
> > ìë°”ìŠ¤í¬ë¦½íŠ¸í™˜ê²½ì—ì„œëŠ” Call Stackì´ ë¹„ì›Œì§„ í›„ì— [Callback Queue(Event Loop)](./#javascriptì—ì„œ-ë¹„ë™ê¸°-í”„ë¡œê·¸ë˜ë°ì„-ê°€ëŠ¥í•˜ê²Œ-í•´ì£¼ëŠ”-ìš”ì†Œë“¤)ì— ìˆëŠ” ì‘ì—…ì„ ì²˜ë¦¬ í•  ìˆ˜ ìˆê³  ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ì€ Callback Queue(Event Loop)ì— ë“¤ì–´ê°„ë‹¤.



## ì™œ JavascriptëŠ” ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•´ì•¼ë§Œ í•˜ëŠ”ê°€?

`Javascript`ê°€ ì•„ë‹Œ `C`, `C++`, `Java` ì™€ ê°™ì€ OSë¥¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” ë‹¤ë¥¸ ì–¸ì–´ë“¤ì„ ë³´ë©´ **ë©€í‹° ìŠ¤ë ˆë”©**ì´ë¼ëŠ” ê²ƒì„ ì§€ì›ì„ í•˜ëŠ”ë°, ì´ ë©€í‹° ìŠ¤ë ˆë”©ì—ì„œëŠ” **ìŠ¤ë ˆë“œ**ë¼ëŠ” ê²ƒì„ ì´ìš©í•´ì„œ ì‘ì—…ì˜ ì£¼ì²´ë¥¼ ê³„ì†í•´ì„œ ëŠ˜ë ¤ì„œ ë³‘ë ¬ì ìœ¼ë¡œ ì‘ì—…ì„ í•  ìˆ˜ê°€ ìˆë‹¤.

ìœ„ ìƒí™©ì— ëŒ€ì…í•´ë³´ë©´, ì£¼ë¬¸ì„ í•˜ëŠ” ì‚¬ëŒì´ í•œëª…ì”© ì£¼ë¬¸ì„ í•  ë•Œë§ˆë‹¤ ì£¼ë¬¸ì„ ë°›ê³  ì»¤í”¼ë¥¼ ì œê³µí•´ì£¼ëŠ” ì‚¬ëŒì´ ê³„ì†í•´ì„œ ìƒê¸´ë‹¤ê³  ìƒê°ì„ í•˜ë©´ ëœë‹¤.

í•˜ì§€ë§Œ `javascript` ê°€ ì“°ì´ëŠ” `browser`, `node.js` ê°€ **ì‹±ê¸€ ìŠ¤ë ˆë“œë§Œì„ ì§€ì›**í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ì‘ì—…ì£¼ì²´ì—ì„œ ì–¸ì œëë‚ ì§€ ëª¨ë¥´ëŠ” ì—¬ëŸ¬ê°€ì§€ ì‘ì—…ì„ ë§ˆëƒ¥ ê¸°ë‹¤ë¦´ ìˆ˜ ë§Œì€ ì—†ê±°ë‹ˆì™€, ë™ì‹œì— ì²˜ë¦¬í•˜ë ¤ê³  í•˜ë‹¤ ë³´ë‹ˆ ì´ëŸ¬í•œ ë¹„ë™ê¸°ì  ì²˜ë¦¬ë¥¼ í•„ìˆ˜ë¶ˆê°€ê²°í•˜ê²Œ í•  ìˆ˜ ë°–ì— ì—†ë‹¤.

> - ëŒ€í‘œì ì¸ browserì¸ Chromeê³¼ node.js ì˜ ë‚´ë¶€ì—”ì§„ì€ [V8 ì—”ì§„](https://v8.dev/)ì„ ì‚¬ìš©í•˜ëŠ”ë°, ì´ V8ì—”ì§„ì´ ì‹±ê¸€ìŠ¤ë ˆë“œë¡œ ì‘ë™í•œë‹¤.
>
> - ì´ì œì™€ì„œëŠ” ë¸Œë¼ìš°ì €ì—ì„œëŠ” HTML5ì— Web Workerë¥¼ í†µí•œ ë©€í‹°ìŠ¤ë ˆë”©ì„,
>   Node.jsì—ì„œëŠ” Wokerë¥¼ í†µí•´ ë©€í‹°ìŠ¤ë ˆë”©ì„ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤ê³ í•œë‹¤.
> - ë¹„ë™ê¸°ì™€ ë©€í‹°ìŠ¤ë ˆë”©ì€ ì—„ì—°í•œ ì°¨ì´ê°€ ìˆë‹¤.
>   ì•„ë˜ ê·¸ë¦¼ì„ ì°¸ì¡°í•˜ì. ([ë§í¬](https://stackoverflow.com/questions/748175/asynchronous-vs-synchronous-execution-what-does-it-really-mean/748235#748235)ì— ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ê·¸ë ¸ë‹¤)

![Synchronous,Asynchronousë³„ ìŠ¤ë ˆë“œ ì°¨ì´](./sync-async-single-multi-thread-difference.jpg)

## Javascriptì—ì„œëŠ” ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ ì–´ë–»ê²Œ í•˜ëŠ”ê°€?

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì€ ì›¹ì—ì„œëŠ” ì£¼ë¡œ Web APIí•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

- [setTimeout()](https://developer.mozilla.org/ko/docs/Web/API/WindowTimers/setTimeout)
- setInterval()
- [fetch()](https://developer.mozilla.org/ko/docs/Web/API/Fetch_API/Fetch%EC%9D%98_%EC%82%AC%EC%9A%A9%EB%B2%95)
- ë“±ë“±...

### íƒ€ì´ë¨¸ë¡œ ì‚¬ìš©í•  ë•Œ

```js
console.log('start');

setTimeout(function () {
  console.log('ë¹„ë™ê¸° Timer!');
}, 1500);

console.log('end');
```

ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ì‹œê°„ìˆœìœ¼ë¡œ

- 'start' ì¶œë ¥
- 'end' ì¶œë ¥
- 1.5ì´ˆ ë’¤ì— 'ë¹„ë™ê¸° Timer!' ì¶œë ¥

ì´ë ‡ê²Œ ì‘ë™í•˜ê²Œ ë˜ëŠ”ë°, ë¹„ë™ê¸°í•¨ìˆ˜ëŠ” ê²°ê³¼ê°’ì´ ë‚˜ì˜¬ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì§€ì•Šê³  ê·¸ ë‹¤ìŒ ì½”ë“œì¸ 'end'ê°€ ë¨¼ì € ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.



### ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­, ì „ì†¡í•  ë•Œ (Ajax)

ì›¹í˜ì´ì§€ì—ì„œ ëª¨ë“ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆì§€ì•ŠëŠ” ì´ìƒì—ì•¼ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•˜ê³  ë°›ì•„ì˜¤ëŠ” ê²ƒì€ ì›¹ í˜ì´ì§€ ê°œë°œì— ìˆì–´ì„œ í•µì‹¬ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.

ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ë˜í•œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‘ë™í•˜ì•¼ë˜ê¸° ë•Œë¬¸ì— (ì„œë²„ì—ì„œ ì–¸ì œ ìš”ì²­í•œ ê°’ì„ ì¤„ì§€ ì•Œ ìˆ˜ ì—†ìŒ) ê´€ë ¨ í•¨ìˆ˜ë“¤ì´ Web APIë¡œ ì œê³µë˜ì–´ì§„ë‹¤.

```js
console.log('start');

fetch('https://httpbin.org/get')
	.then(function (response) {
  	return response.json();
	})
	.then(function (resultJson) {
  	console.log('ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ìŒ');
  	console.log(JSON.stringify(resultJson));
	});

console.log('end');
```

ì‹œê°„ìˆœìœ¼ë¡œ

- 'start' ì¶œë ¥
- 'end' ì¶œë ¥
- ì„œë²„ì—ì„œ ì‘ë‹µì„ í•´ì¤¬ì„ ë•Œ 'ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ìŒ' ì¶œë ¥ ë° ê²°ê³¼ì¶œë ¥

ë¡œ ì¶œë ¥ì´ ë˜ê³ , ì„œë²„ì—ì„œì˜ ì‘ë‹µì€ ì„œë²„, ë„¤íŠ¸ì›Œí¬ì˜ ìƒí™©ì—ë”°ë¼ ë‹¤ë¥´ê¸°ë•Œë¬¸ì— ì–¸ì œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆëŠ”ì§€ëŠ” ì•Œ ìˆ˜ê°€ ì—†ë‹¤.

## Javascriptì—ì„œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ìš”ì†Œë“¤

Javascriptì—ì„œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ìš”ì†ŒëŠ” ì•„ë˜ ë‘ê°€ì§€ì´ë‹¤.

- Event Loop
- ê³ ì°¨í•¨ìˆ˜ ( `callback` í•¨ìˆ˜ì˜ ì¡´ì¬ )

ëª¨ë“  javascript ì—”ì§„ì—ì„œ ë™ì¼í•˜ê²Œ ì‹¤í–‰ë˜ëŠ” **Event Loop**ëŠ” javascript ë¹„ë™ê¸° ì‘ë™ì„ ì´í•´í•˜ëŠ”ë° ëŒ€ë‹¨íˆ ì¤‘ìš”í•œ ê·¼ë³¸ ì›ë¦¬ë¼ í•  ìˆ˜ ìˆë‹¤.

> ì´ **Event LoopëŠ” Call Stackì´ ë¹„ì›Œì§€ë©´ ì‹¤í–‰**ëœë‹¤.

ëª¨ë“  ë¹„ë™ê¸° í•¨ìˆ˜ì—ì„œ ë°›ì•„ì„œ ì‹¤í–‰ í•  callback í•¨ìˆ˜ë“¤ì€ ë¹„ë™ê¸° í•¨ìˆ˜ ì‹¤í–‰ ì™„ë£Œ í›„ `Callback Queue` ì— ë“¤ì–´ê°€ê²Œ ë˜ëŠ”ë° ì´ `Callback Queue` ëŠ” `Call Stack`ì´ ë¹„ì›Œì§„ ì´í›„ì— í•˜ë‚˜ì”© `Callback Queue`ì— ìˆëŠ” í•¨ìˆ˜ë“¤ì„ êº¼ë‚´ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤. ì¦‰, ì´ ë§ì€ ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì´ë¯¸ ì¢…ë£Œëœ ì‹œì ì—ì„œ `Call Stack`ì´ ë¹„ì›Œì§„ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ ì¢…ë£Œ í›„ í˜¸ì¶œí•˜ëŠ” `Callback` í•¨ìˆ˜ê°€ ê³§ë°”ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤ëŠ” ë§ì´ë‹¤. ì¦‰, **`Callback` í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œì ì„ ë³´ì¥ í•  ìˆ˜ ì—†ë‹¤**ëŠ” ë§.

ì–´ì¨Œë“  ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” Callbackí•¨ìˆ˜ëŠ” `Call Stack`ì´ ë¹„ì›Œì ¸ì•¼ë§Œ ì‹¤í–‰ëœë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œì•„ë‘ì.

> ë¹„ë™ê¸° Callback í•¨ìˆ˜ì—ì„œ ë‹¤ì‹œ ë¹„ë™ê¸° ìš”ì²­(ì½œë°±ì¤‘ì²©)ì„ í•  ê²½ìš°ì—ëŠ” Event Loopë‚´ì—ì„œ ì‹¤í–‰ë˜ì—ˆë‹¤ê³  í•  ìˆ˜ ìˆë‹¤.

```js
// 3ì´ˆë’¤ ì¶œë ¥í•˜ëŠ” ë¹„ë™ê¸°ì‘ì—… ì‹œì‘.
window.setTimeout(function () {
  console.log('call back!');
}, 3000);

function infinityFunc () {
	while(true) {
  	// ...
	}  
}

infinityFunc();
```

ê·¹ë‹¨ì ìœ¼ë¡œ ìœ„ì˜ ì˜ˆì œì²˜ëŸ¼ `infinity()`í•¨ìˆ˜ì˜ ë¬´í•œë£¨í”„ë¡œì¸í•´ `Call Stack` ì´ ë¹„ì›Œì§€ì§€ì•Šì•„ì„œ 3ì´ˆë’¤ì— ìš°ë¦¬ê°€ ì›í•˜ëŠ” ì¶œë ¥ê°’ì„ ì–»ì„ ìˆ˜ ì—†ëŠ”ê±¸ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

![event loop](./á„’á…¡á„‹á…©á†¼á„‹á…´-á„Œá…¡á„‡á…¡á„‰á…³á„á…³á„…á…µá†¸á„á…³-á„‰á…µá†¨á„‰á…¡---Asynchronous-Programming_eventloop.png)

ì´ë¯¸ì§€ ì¶œì²˜ : [VanillaCoding - Prepê°•ì˜](https://www.vanillacoding.co/)

### í˜¹ì‹œ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ê°•ì œë¡œ ì¢…ë£Œì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œ?

**ì´ë¯¸ ì˜ˆì•½(ì‹¤í–‰)ëœ ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” ìš°ë¦¬ê°€ ê°•ì œë¡œ ì¢…ë£Œì‹œí‚¬ ìˆ˜ ì—†ë‹¤.**

`setTimeout`ì´ë‚˜ `setInterval`ì€ ë¦¬í„´ ë°›ì€ idë¡œ `clearInterval`í˜¹ì€ `clearTimeout`ë¡œ ì¢…ë£Œì‹œí‚¬ìˆ˜ëŠ” ìˆì§€ë§Œ ë‹¤ë¥¸ Ajaxìš”ì²­ë“±ê³¼ ê°™ì€ ë¹„ë™ê¸°í•¨ìˆ˜ë“¤ì€ ê°•ì œë¡œ ì¢…ë£Œì‹œí‚¬ ë°©ë²•ì´ ì—†ë‹¤. 

ë§Œì•½ ë¹„ë™ê¸° í•¨ìˆ˜ë“¤ë¼ë¦¬ ë¡œì§ì´ ì—°ê²°ë˜ì–´ìˆë‹¤ë©´ ì°¨ì„ ì±…ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```js{2,18-20,26}
let successCount = 0;
let isErrorOccurred = false;
const asyncFuncList = [asyncFunc, asyncFunc, asyncFunc_Err, asyncFunc, asyncFunc]; // ë³‘ë ¬ë¡œ í•œêº¼ë²ˆì— ì‹¤í–‰ì‹œí‚¬ ë¹„ë™ê¸°í•¨ìˆ˜ë“¤

function asyncFunc (callback) {
  window.setTimeout(() => {
    callback();
  }, 3000);
}

function asyncFunc_Err (callback) {
  window.setTimeout(() => {
    callback('err'); // ê°•ì œë¡œ ì• ëŸ¬ ë°œìƒ
  }, 3000)
}

function commonCallbackFunc (isErr) {
  if (isErrorOccurred) {
    return;
  }
  
  if (isErr) {
    // ì• ëŸ¬ì²˜ë¦¬
    console.log('ì• ëŸ¬ë°œìƒ!');
    console.log('ì§€ê¸ˆê¹Œì§€ ìˆ˜í–‰í•œ ë¹„ë™ê¸°í•¨ìˆ˜ : ', successCount);
    isErrorOccurred = true;
    return;
  }
  
  successCount += 1; // ì‘ì—… ì„±ê³µì´ë©´ ì¹´ìš´íŠ¸ ì¦ê°€
  
  if (successCount === asyncFuncList.length) {
    console.log('ì‘ì—… ì™„ë£Œ!');
    console.log('ì§€ê¸ˆê¹Œì§€ ìˆ˜í–‰í•œ ë¹„ë™ê¸°í•¨ìˆ˜ : ', successCount);
  }
}

for (const asyncFunc of asyncFuncList) {
  asyncFunc(commonCallbackFunc); // ë¹„ë™ê¸° í•¨ìˆ˜ ì‹¤í–‰
}
```

ì†ŒìŠ¤ëŠ” ë³‘ë ¬ë¡œ í•œêº¼ë²ˆì— ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ê³  ë§Œì•½ ì• ëŸ¬ê°€ ë°œìƒí–ˆë‹¤ë©´ ë‚˜ë¨¸ì§€ ì‘ì—…ì™„ë£Œê°€ ë˜ì§€ì•Šì€ ë¹„ë™ê¸°í•¨ìˆ˜ë“¤ì˜ ì‘ì—…ì„ ì¤‘ë‹¨ì‹œí‚¤ê³ ì í•  ë•Œì˜ ì˜ˆì œì´ë‹¤.

ì‘ì—… ì¤‘ë‹¨ì„ í•˜ê³ ì‹¶ì§€ë§Œ ê·¸ë ‡ê²Œ í•  ìˆ˜ ì—†ê¸°ì— ì°¨ì„ ì±…ìœ¼ë¡œ `isErrorOccurred`ì´ë€ Flagë¥¼ ë‘ì–´ ë¹„ë™ê¸° í•¨ìˆ˜ì˜ ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ì€ ë˜ì§€ë§Œ ì´ëŸ¬í•œ Flagë¥¼ í†µí•´ ì´í›„ ì‘ì—…ì„ ë§‰ì„ ìˆ˜ ìˆë‹¤.

ìœ„ ì†ŒìŠ¤ëŠ” ë¹„ë™ê¸° ì‘ì—…ì´ê¸° ë•Œë¬¸ì— `successCount`ê²°ê³¼ëŠ” ì¥ë‹´í•  ìˆ˜ ì—†ì§€ë§Œ ì•„ë§ˆ 3ì´ˆë’¤ì—

```console
ì• ëŸ¬ë°œìƒ!
ì§€ê¸ˆê¹Œì§€ ìˆ˜í–‰í•œ ë¹„ë™ê¸°í•¨ìˆ˜ : 2
```

 ê°€ ë‚˜ì˜¬ ê²ƒì´ë‹¤.



## ì´ˆì°½ê¸° ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

#### Callback Function

ìš°ë¦¬ê°€ ë¹„ë™ê¸°í”„ë¡œê·¸ë˜ë°ì„ í•˜ëŠ”ë° ìˆì–´ì„œ, ê°€ì¥ ê¸°ë³¸ì ì¸ ë°©ë²•ì€ ì½œë°±í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

ì½œë°±í•¨ìˆ˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ê°€ ëë‚¬ì„ ë•Œ ì‹¤í–‰í•´ì„œ ë¹„ë™ê¸°í•¨ìˆ˜ì˜ ê²°ê³¼ê°’ì„ ì²˜ë¦¬í•˜ë„ë¡í•˜ê±°ë‚˜ ë˜ëŠ” ì• ëŸ¬ê°€ ë‚¬ì„ ë•Œ ì‹¤í–‰í•´ì„œ ì• ëŸ¬ì²˜ë¦¬ë¥¼ í•˜ê²Œë” í•  ìˆ˜ ìˆë‹¤.

```js{14,18}
var errFlag = false;

function standardCallback (err, result) {
  if (err) {
    console.log('ì• ëŸ¬ ë°œìƒ : ', err); // ì• ëŸ¬ë©”ì„¸ì§€ ì¶œë ¥
    return;
  }
  
  console.log('ê²°ê³¼ ê°’ : ', result); // ê²°ê³¼ê°’ ì¶œë ¥
}

function asyncFunc (callback) {
  if (errFlag) {
    callback('error'); // callback í•¨ìˆ˜ì˜ ì²«ë²ˆì§¸ ì¸ìê°’ì€ ì• ëŸ¬ë©”ì„¸ì§€
  }
  
  setTimeout(function () {
    callback(null, 'this is callback function!'); // errorê°€ ì—†ìœ¼ë¯€ë¡œ null
  }, 2000);
}

asyncFunc(standardCallback);
```

#### Continuation Passing Style (Callback Hell)

í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì½œë°±í•¨ìˆ˜ë¥¼ ì´ìš©í•˜ëŠ” ë°©ë²•ì—ëŠ” í° ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ëŠ”ë° ì•„ë˜ ì½”ë“œë¥¼ ë³´ì.

> ì†ŒìŠ¤ ì¶œì²˜ : [callbackhell.com](http://callbackhell.com/)

```js
fs.readdir(source, function (err, files) {
  if (err) {
    console.log('Error finding files: ' + err)
  } else {
    files.forEach(function (filename, fileIndex) {
      console.log(filename)
      gm(source + filename).size(function (err, values) {
        if (err) {
          console.log('Error identifying file size: ' + err)
        } else {
          console.log(filename + ' : ' + values)
          aspect = (values.width / values.height)
          widths.forEach(function (width, widthIndex) {
            height = Math.round(width / aspect)
            console.log('resizing ' + filename + 'to ' + height + 'x' + height)
            this.resize(width, height).write(dest + 'w' + width + '_' + filename, function(err) {
              if (err) console.log('Error writing file: ' + err)
            })
          }.bind(this))
        }
      })
    })
  }
});
```

ìœ„ ì†ŒìŠ¤ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì²˜ë¦¬ë¥¼ í•˜ê³  ìˆë‹¤.

- ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ í›„ ì‹¤í–‰ë˜ëŠ” ì½œë°±í•¨ìˆ˜ì— ë˜ ë‹¤ì‹œ ë¹„ë™ê¸° ì‘ì—… (ë¹„ë™ê¸° ì§ë ¬)
- ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ í›„ ì‹¤í–‰ë˜ëŠ” ê°ê°ì˜ ì½œë°±í•¨ìˆ˜ì—ì„œ ì• ëŸ¬ í•¸ë“¤ë§

ë§Œì•½, ë¹„ë™ê¸° í•¨ìˆ˜ì— ì´ëŸ¬í•œ ì‘ì—…ì„ ê³„ì†í•´ì„œ í•  ê²½ìš°(ì½œë°±í•¨ìˆ˜ê°€ ì¤‘ì²©ë  ê²½ìš°) **ê°€ë…ì„±ì´ ë§¤ìš° ë–¨ì–´ì§€ê²Œ ëœë‹¤.**

ì´ëŸ¬í•œ í˜„ìƒì„ ê°€ë¦¬ì¼œ **ì½œë°± ì§€ì˜¥** ì´ë¼ê³  í•œë‹¤.



## í˜„ì¬ì˜ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°

ìœ„ì—ì„œ ë´¤ë˜ ê°€ë…ì„±ì´ë‚˜ ì• ëŸ¬í•¸ë“¤ë§ ë“±ê³¼ ê°™ì€ ì´ˆì°½ê¸° ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì˜ íë¦„ì„ ì–´ë–»ê²Œí•˜ë©´ íš¨ìœ¨ì ìœ¼ë¡œ í’€ì–´ë‚˜ê°ˆì§€ì— ëŒ€í•œ ê³ ë¯¼ì€ ì§€ê¸ˆê¹Œì§€ë„ ê³„ì†ë˜ê³  ìˆìœ¼ë©°, ë§ì€ ì‹œë„ë“¤ì´ ì§„í–‰ë˜ì—ˆë‹¤.

- **Promise**
- **Async / Await** - ES2017(ES8)
- Generators - ES2017(ES8)
- Observers - ES2016(ES7)
- ê¸°íƒ€ ë¼ì´ë¸ŒëŸ¬ë¦¬...

ì´ì™€ ê°™ì€ ë°©ë²•ë“¤ì´ ìˆëŠ”ë°,

**`Promise` ì™€ `Async / Await`ê°€ ê°€ì¥ ëŒ€í‘œì ì¸ ë°©ë²•**ì´ë¼ í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.

> Async / Await ëŠ” Promiseë¥¼ ìš°ì„ ì ìœ¼ë¡œ ì´í•´í•´ì•¼ í•œë‹¤.



ê·¸ë˜ì„œ ìš°ì„ , `Promise`ì™€ `Async / Await`ì— ëŒ€í•´ì„œë§Œ **ê°„ë‹¨í•˜ê²Œ** ì•Œì•„ë³´ê³  ìì„¸í•œ ì‚¬í•­ì´ë‚˜ ë‚˜ë¨¸ì§€ëŠ” ë”°ë¡œ ì°¾ì•„ë³¼ ìˆ˜ ìˆë„ë¡ í•˜ì.



## Promise

**Promise**ëŠ” Javascript ë¹„ë™ê¸° ì‘ì—…ì„ ë„ì™€ì£¼ëŠ” ê°ì²´ë¡œ ë¹„ë™ê¸° ì‘ì—…ì˜ ìƒíƒœì™€ ê²°ê³¼, ì• ëŸ¬ í•¸ë“¤ë§ ë“±ì„ ë„ì™€ì¤„ ìˆ˜ ìˆë‹¤.

ì‚¬ì‹¤ ë§ì€ ì‚¬ëŒë“¤ì´ **Promise**ë¥¼ ì½œë°±ì§€ì˜¥ì˜ í•´ê²°ì±…ì´ë¼ê³  ìƒê°í•˜ëŠ”ë°, ì´ëŠ” ì˜ëª»ë˜ì—ˆë‹¤.<br>
Promise ë˜í•œ Promiseì˜ ê²°ê³¼ì— ë˜ Promiseë¥¼ ì¤‘ì²©í•´ì„œ ì‚¬ìš©í•˜ë©´ ì½œë°±ì§€ì˜¥ê³¼ ë‹¤ë¥¼ ë°” ì—†ë‹¤.

> PromiseëŠ” ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì— ìˆì–´ì„œ ë¹„ë™ê¸° ì‘ì—…ì˜ ìƒíƒœí™•ì¸, ì• ëŸ¬í•¸ë“¤ë§ê³¼ ê°€ë…ì„±í–¥ìƒì— ëŒ€í•´ ì´ì ì„ ê°€ì§€ê³  ìˆì§€ ì½œë°±ì§€ì˜¥ì„ ê·¼ë³¸ì ìœ¼ë¡œ í•´ê²°í•˜ëŠ” í•´ê²°ì±…ì´ë¼ê³  ë³´ê¸°ì—ëŠ” ë¬´ë¦¬ê°€ ìˆë‹¤. 

### Promise ì‚¬ìš©ë²•

#### 1. Promiseê°ì²´ ìƒì„±(ë¹„ë™ê¸° ì‘ì—… ìˆ˜í–‰) - Pending

```js
const promise = new Promise(function (resolve, reject) {
  // ì‘ì—… ìˆ˜í–‰ì‹œ resolve() í˜¸ì¶œ
  // ì• ëŸ¬ì‹œ reject() í˜¸ì¶œ
}) 
```

ë‹¤ìŒê³¼ ê°™ì´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ìƒì„± í•  ìˆ˜ ìˆìœ¼ë©° **í”„ë¡œë¯¸ìŠ¤ ê°ì²´ë¥¼ ìƒì„±í•˜ë©´ <u>ê³§ë°”ë¡œ</u> ì¸ìë¡œ ì „ë‹¬ í•œ ë¹„ë™ê¸° í•¨ìˆ˜ê°€ ì‹¤í–‰**ëœë‹¤.

ì´ ê³§ë°”ë¡œ í˜¸ì¶œë˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ëŠ” `resolve`ì™€ `reject` ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë°›ì•„ì•¼ë˜ê³  ì‚¬ìš©ë²•ì€ ì•„ë˜ì—ì„œ ì„¤ëª…í•œë‹¤.

ê·¸ë¦¬ê³  ì´ ìƒíƒœì—ì„œëŠ” ëŒ€ê¸°ìƒíƒœì¸ **Pending**ì´ ëœë‹¤.



#### 2. resolve() í˜¸ì¶œ - Fulfilled

```js{3,7}
const promise = new Promise(function (resolve, reject) {
  setTimeout(() => {
    resolve(20);
  }, 3000);
});

promise.then((result) => {
  console.log(result);
});

// 3ì´ˆ ë’¤ 20 ì¶œë ¥
```

ì´ì²˜ëŸ¼ ë¹„ë™ê¸° ì‘ì—…ì„ ì™„ë£Œ í›„ì— `resolve(ê²°ê³¼ê°’)` ìœ¼ë¡œ í˜¸ì¶œ í•˜ë©´ Promiseê°ì²´ì˜ ìƒíƒœëŠ” **Fullfilled** ê°€ ëœë‹¤.

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ `then()` ì„ í†µí•´ ìœ„ Promiseê°ì²´ ìƒì„±ì‹œ ì¸ìë¡œ ë„£ì€ ë¹„ë™ê¸°í•¨ìˆ˜ì—ì„œ í˜¸ì¶œí•œ `resolve(ê²°ê³¼ê°’)` ë¥¼ ì½œë°±í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```js 
Promise.then(function calledResolve(result) {
  // resolve(ê²°ê³¼ê°’)ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì½œë°±í•¨ìˆ˜
})
```

ê·¸ë¦¬ê³  ì´ `then()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê³  ë‚˜ë©´ ìƒˆë¡œìš´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.

> return ê°’ì€ ë‹¤ìŒ then ë©”ì„œë“œ ì½œë°±í•¨ìˆ˜ì˜ ê²°ê³¼ë¡œ ì „ë‹¬

ì´ë¥¼ í†µí•´ 4ë²ˆê³¼ ê°™ì€ Promise Chainingì´ ê°€ëŠ¥í•´ì§„ë‹¤.



#### 3. reject() í˜¸ì¶œ - Rejected

```js{3,13}
const promise = new Promise(function (resolve, reject) {
  setTimeout(() => {
    reject(new Error('rejectí˜¸ì¶œ'));
  }, 1000);
  
  setTimeout(() => {
    resolve(20);
  }, 3000);
});

promise.then((result) => {
  console.log(result);
}).catch((err) => {
  console.log(err);
});

// 1ì´ˆ ë’¤ Error: rejectí˜¸ì¶œ ì¶œë ¥
```

ìœ„ì™€ ê°™ì´ `reject(ì• ëŸ¬)` ë¡œ í˜¸ì¶œí•˜ë©´ Promise ê°ì²´ì˜ ìƒíƒœëŠ” **Rejected**ê°€ ëœë‹¤.

ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ `catch`ë¥¼ í†µí•´ ìœ„ Promiseê°ì²´ ìƒì„±ì‹œ ì¸ìë¡œ ë„£ì€ ë¹„ë™ê¸°í•¨ìˆ˜ì—ì„œ í˜¸ì¶œí•œ `reject(ì• ëŸ¬)`ë¥¼ ì½œë°±í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

```js
Promise.catch(function calledReject(err) {
  // reject(err)ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì½œë°±í•¨ìˆ˜
})
```



#### 4. Promise Chaining

í”„ë¡œë¯¸ìŠ¤ì˜ íŠ¹ì§•ì€ ì—¬ëŸ¬ê°œì˜ í”„ë¡œë¯¸ìŠ¤ë¥¼ ì—°ê²°í•´ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

ìœ„ì—ì„œ `then()`ì„ í˜¸ì¶œí•˜ë©´ ìƒˆë¡œìš´ Promiseê°ì²´ê°€ í˜¸ì¶œëœë‹¤ê³  í•˜ì˜€ë‹¤.

ì´ë¥¼ í†µí•´ `then()`ì˜ ì½œë°±í•¨ìˆ˜ì—ì„œ ë˜ ë‹¤ì‹œ ë¹„ë™ê¸° í˜¸ì¶œì„ í•  ìˆ˜ ìˆìœ¼ë©° return ê°’ì€ ë‹¤ìŒ `then()` ë©”ì„œë“œ ì½œë°±í•¨ìˆ˜ì˜ ê²°ê³¼ë¡œ ì „ë‹¬ëœë‹¤.

```js
new Promise(function(resolve, reject){
  setTimeout(function() {
    resolve(1);
  }, 2000);
})
.then(function(result) {
  console.log(result); // 1
  return result + 10;
})
.then(function(result) {
  console.log(result); // 11
  return result + 20;
})
.then(function(result) {
  console.log(result); // 31
});
```

ì˜ˆì œ ì¶œì²˜ : [ìº¡í‹´íŒêµë‹˜ì˜ Promise](https://joshua1988.github.io/web-development/javascript/promise-for-beginners/)



![Promise ì²˜ë¦¬ íë¦„](./promiseá„á…¥á„…á…µá„’á…³á„…á…³á†·.svg)

ì´ë¯¸ì§€ ì¶œì²˜ : [MDN - Promise](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise)



#### 5. Promiseì˜ ì˜ˆì™¸ì²˜ë¦¬

3ë²ˆì—ì„œ ì‚´í´ë´¤ë˜  `catch`ëŠ” ê¸°ì¡´ì˜ ë¬¸ì œì ì´ì—ˆë˜ ê°ê° ì½œë°±í•¨ìˆ˜ ê°œë³„ì—ì„œ ì• ëŸ¬ì²˜ë¦¬í•˜ë˜ ê²ƒì„ íšê¸°ì ìœ¼ë¡œ í•´ê²° í•´ ì£¼ì—ˆë‹¤.

> ë§ˆì¹˜ try-catchë¬¸ê³¼ ê°™ì€ ì• ëŸ¬ì²˜ë¦¬ê°€ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì—ë„ ê°€ëŠ¥í•´ì¡Œë‹¤.



ë§Œì•½ ë¹„ë™ê¸° ì²˜ë¦¬ì¤‘ì— ì•Œ ìˆ˜ ì—†ëŠ” ì• ëŸ¬ì²˜ë¦¬ê°€ ë°œìƒí•´ì„œ `reject`ë„ ëª»ì“°ëŠ” ê²½ìš°ê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ë ê¹Œ?

```js
const promise = new Promise(function (resolve, reject) {
  setTimeout(() => {
    resolve(20);
  }, 3000);
});
                            
getData().then(function(result) {
  console.log(result); // 3ì´ˆ ë’¤ 20 ì¶œë ¥
  throw new Error("ì²«ë²ˆì§¸ thenì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” ì• ëŸ¬ ë°œìƒ!"); // ì²«ë²ˆì§¸ thenì—ì„œ ì• ëŸ¬ ë°œìƒ
}).catch(function(err) {
  console.log(err); //Error: ì²«ë²ˆì§¸ thenì—ì„œ ì•Œ ìˆ˜ ì—†ëŠ” ì• ëŸ¬ ë°œìƒ! ì¶œë ¥
});
```

ì´ ì²˜ëŸ¼ `catch()`ë¥¼ ì´ìš©í•˜ë©´ ë¹„ë™ê¸° ì²˜ë¦¬ ì¤‘ì— ì•Œ ìˆ˜ ì—†ëŠ” ì• ëŸ¬ì²˜ë¦¬ê°€ ë°œìƒí•˜ë”ë¼ë„ ì• ëŸ¬ í•¸ë“¤ë§ì„ í•  ìˆ˜ ìˆë‹¤.

ë˜ 4ë²ˆì—ì„œ ë´¤ë˜ Promise Chainingìœ¼ë¡œ ì´ë£¨ì–´ì§„ ë¹„ë™ê¸° ì²˜ë¦¬ë¼í•˜ë”ë¼ë„ `catch()` ë§Œ ì“´ë‹¤ë©´ ì–´ë–¤ `then()` ì—ì„œ `reject()` ë‚˜ ì•Œ ìˆ˜ ì—†ëŠ” ì• ëŸ¬ê°€ ë°œìƒí•˜ë”ë¼ë„ ëª¨ë‘ `catch()`ê°€ ê°€ëŠ¥í•´ì§€ëŠ” ìš°ì•„í•œ ë¹„ë™ê¸° ì• ëŸ¬ í•¸ë“¤ë§ì´ ê°€ëŠ¥í•´ì§„ë‹¤.

ì´ëŠ” ì´ì „ì— ì´ˆì°½ê¸° ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ë°©ì‹ì´ë˜

```js
function callback(err, result) {
  if (err) {
    console.log(err);
    return;
  }
  
  console.log(result);
}
```

ì™€ ê°™ë˜ ê°ê° ê°œë³„ ì½œë°±í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬í•˜ë˜ ì• ëŸ¬í•¸ë“¤ë§ì„ íšê¸°ì ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆê²Œ í•˜ì˜€ë‹¤. ğŸ‘

ê·¸ë˜ì„œ **Promiseê°ì²´ë¥¼ ì‚¬ìš© í•  ë•Œ `catch()`ëŠ” í•­ìƒ ì‚¬ìš©** í•˜ëŠ” ê²ƒì´ ë³´ë‹¤ secure programmingí•˜ê²Œ ì‘ì„±í•˜ëŠ” ê²ƒì´ë¼ í•  ìˆ˜ ìˆë‹¤.



#### 6. Promise ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬

Promiseê°ì²´ëŠ” Javascriptì—ì„œ `Object` íƒ€ì…ìœ¼ë¡œ [1ê¸‰ ì‹œë¯¼](../../../../2020/javascript/í•˜ì˜¹ì˜-ìë°”ìŠ¤í¬ë¦½íŠ¸-ì‹ì‚¬---Closure/í•˜ì˜¹ì˜-ìë°”ìŠ¤í¬ë¦½íŠ¸-ì‹ì‚¬---Closure/#ğŸ¤µ1ê¸‰-ì‹œë¯¼-first-class-citizen) ì¦‰, **1ê¸‰ ê°ì²´** ì´ë‹¤.

ì´ ë§ì¸ ì¦‰ìŠ¨ í•¨ìˆ˜ì˜ ì¸ìê°’ìœ¼ë¡œ ì „ë‹¬ ê°€ëŠ¥í•˜ë‹¤ëŠ” ë§ì´ë‹¤.

```js{17}
const promise = new Promise((resolve, reject) => {
  setTimeout(() => {
    resolve(30);
  }, 3000);
});

function func (promiseProp) {
  let value = 100;
  promiseProp.then((result) => {
    console.log(result);
    console.log(100);
  }).catch((err) => {
    console.log(err);
  });
}

func(promise); // promise ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬
```

ì´ ì²˜ëŸ¼ í”„ë¡œë¯¸ìŠ¤ê°ì²´ë¥¼ ë‹¤ë¥¸ í•¨ìˆ˜ë¡œ ì „ë‹¬í•˜ì—¬ ê·¸ í•¨ìˆ˜ì˜ í•¨ìˆ˜ìŠ¤ì½”í”„ë¥¼ ì´ìš©í•œ ì½œë°±ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì§„ë‹¤.

3ì´ˆí›„ ê²°ê³¼ ì¶œë ¥

```js
30
100
```



### Promiseì˜ ì¥ì  ğŸ‘

í”„ë¡œë¯¸ìŠ¤ì˜ ì¥ì ì€ ìœ„ì˜ ì‚¬ìš©ë²•ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´

- ë¹„ë™ê¸° í”„ë¡œì„¸ì‹±ì˜ ê°€ë…ì„±ì˜ í–¥ìƒ
- íšê¸°ì ì¸ ì• ëŸ¬ í•¸ë“¤ë§
- ë¹„ë™ê¸° ì‹¤í–‰ì˜ ìƒíƒœ í™•ì¸
- Promiseê°ì²´ë¥¼ í•¨ìˆ˜ ì¸ìë¡œ ë„˜ê¸¸ ìˆ˜ ìˆìŒ (1ê¸‰ ê°ì²´)



## Async / Await

Async / Await ëŠ” Promiseë³´ë‹¤ ë” ì¢‹ì€ ê°€ë…ì„±ìœ¼ë¡œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆë‹¤.

**ë§ˆì¹˜ ë™ê¸°ì ìœ¼ë¡œ ì‘ì„±í•œ ì½”ë“œì²˜ëŸ¼** ê°€ë…ì„±ì´ ë§¤ìš° ì¢‹ì•„ì§„ë‹¤.

í•˜ì§€ë§Œ ì‚¬ìš©í•¨ì— ìˆì–´ì„œ Promiseë¥¼ ì´í•´í•˜ê³  ì‚¬ìš©í•˜ë„ë¡í•˜ì.



### Async / Await ì‚¬ìš©ë²•

#### Async Functrion

Async / Awaitë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ Async Functionì„ ìƒì„±í•´ì•¼ í•œë‹¤.

Async Functionì€ í•¨ìˆ˜ ì„ ì–¸ì‹œ ì•ì— `async` í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´ ë˜ê³ ,
ì´ Async Function ë‚´ë¶€ì—ì„œëŠ” `await`í‚¤ì›Œë“œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

> ì¶”í›„ await í‚¤ì›Œë“œëŠ” êµ³ì´ async functionì´ ì•„ë‹ˆì–´ë„ ì‚¬ìš© í•  ìˆ˜ ìˆê²Œ ëœë‹¤ê³  í•œë‹¤.

```js
async function asyncFunc () {
  // await ì‚¬ìš© ê°€ëŠ¥
}
```

##### Async Functionì€ Promise ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.

ì´ Async Functionì€ í•œê°€ì§€ íŠ¹ì´ì ì´ ìˆë‹¤ë©´ â—ï¸**ìë™ì ìœ¼ë¡œ ë¦¬í„´ê°’ì´ Promiseê°ì²´**â—ï¸ë¼ëŠ” ê²ƒì´ë‹¤.

ìœ„ í•¨ìˆ˜ì˜ ê²°ê³¼ê°’ì€ ì¶œë ¥í•´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```js
console.log(asyncFunc());
```



![async function return1](./asyncFuncionReturnUndefined.png)

ì•„ë¬´ê²ƒë„ ë¦¬í„´í•˜ì§€ ì•Šì•˜ì§€ë§Œ ìë™ì ìœ¼ë¡œ Promiseê°ì²´ê°€ ë¦¬í„´ë˜ì—ˆìœ¼ë©° **fulfilled**ìƒíƒœì˜ `undefined`ê°’ì„ ë‹´ê³ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

> ì´ ë§ì€ resolve() ì²˜ëŸ¼ ì•„ë¬´ ì¸ìë„ ì—†ì´ resolve() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ìƒíƒœì™€ ê°™ë‹¤.

ë§Œì•½ async functionì—ì„œ <u>ê°’ì„ **return** í•´ì¤€ë‹¤ë©´</u> ì–´ë–»ê²Œ ë ê¹Œ?

```js
async function asyncFunc () {
  return 123;
}

console.log(asyncFunc());
```

ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

![async function return 2](./asyncFunctionReturnValue.png)

ë°”ë¡œ Promise ê°ì²´ì˜ ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì•„ì˜¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

ì´ëŠ” `resolve(123);` í•œ ê²ƒê³¼ ê²°ê³¼ê°€ ê°™ì€ë°, ì´ëŠ” ì´ ë¦¬í„´ëœ Promiseê°ì²´ë¥¼ `then()`ë©”ì†Œë“œë¥¼ ì ìš©ì‹œí‚¤ë©´ ì´ ë¦¬í„´ë°›ì€ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒê³¼ ê°™ë‹¤.

```js
async function asyncFunc () {
  return 123;
}

asyncFunc().then((result) => {
  console.log(result); // 123 ì¶œë ¥
})
```

ê·¸ëŸ¼ ì´ì œ ì—¬ê¸°ì„œ ì–´ë–»ê²Œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ í•  ìˆ˜ ìˆì„ê¹Œ? 

#### await í‚¤ì›Œë“œ

ë°”ë¡œ `await`í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ì•¼ ë˜ëŠ”ë°, await`í‚¤ì›Œë“œëŠ” **Promiseê°ì²´**ê°€ **Fulfilled** ìƒíƒœê°€ ë  ë•Œ ê¹Œì§€ **ê¸°ë‹¤ë ¤ì£¼ëŠ”** ì—­í• ì„ í•œë‹¤.

> Fulfilled ìƒíƒœê°€ ëœë‹¤ëŠ”ê±´, resolve() ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸.

```js{11}
function resolveAfter2Seconds(x) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(x);
    }, 2000);
  });
}

async function add1(x) {
  console.log("start");
  const a = await resolveAfter2Seconds(20);
  console.log("a", a);
  return x + a;
}

add1(10).then((v) => {
  console.log(v);
});

console.log("finish");
```

ì˜ˆì œ ì°¸ì¡° : [vanilla coding - bootCamp 9 1ì£¼ì°¨ ìˆ˜ì—…](https://www.vanillacoding.co/)

ë‹¤ìŒê³¼ ê°™ì´ async function ë‚´ë¶€ì—ì„œ `await`í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•˜ì˜€ê³ , ì´ëŠ” `resolveAfter2Seconds(20)`ìœ¼ë¡œ ë¦¬í„´ë°›ëŠ” Promiseê°ì²´ê°€ **Fullfilled** ìƒíƒœê°€ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë‹¤ìŒ ì½”ë“œë¡œ ë„˜ì–´ê°€ê²Œ ëœë‹¤.

ê·¸ë˜ì„œ ì¶œë ¥ ìˆœì„œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

- 16ë¼ì¸ `add1(10)` í•¨ìˆ˜ í˜¸ì¶œ
  - `.then()`ì€ async í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ì´ê¸° ë•Œë¬¸ì— ê°€ëŠ¥
  - ê²°êµ­, async í•¨ìˆ˜ê°€ returnë˜ì–´ì•¼ `then()`ì˜ ì½œë°±í•¨ìˆ˜ê°€ ìˆ˜í–‰ë¨

- **start ì¶œë ¥**
- await í‚¤ì›Œë“œë¡œì¸í•´ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ resolve ë  ë•Œ ê¹Œì§€ ëŒ€ê¸° 
  - ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê° (async í•¨ìˆ˜ì˜ ì½˜í…ìŠ¤íŠ¸ë¥¼ ë²—ì–´ë‚¨)
- **finish ì¶œë ¥**
- 2ì´ˆ í›„ pending ìƒíƒœì´ë˜ í”„ë¡œë¯¸ìŠ¤ ê°ì²´ resolve ë˜ì–´ í•´ë‹¹ ì‹œì ì—ì„œ ë‹¤ì‹œ ì§„í–‰
  - aì— ìµœì¢… ê°’ 20 í• ë‹¹
- **a 20 ì¶œë ¥**
- add1 í•¨ìˆ˜ `x + a` ê°’ì¸ 30 ë¦¬í„´
- **10 ì¶œë ¥**
  - add1í•¨ìˆ˜ê°€ ë¦¬í„´ë˜ì—ˆê¸° ë•Œë¬¸ì— `.then()`ì˜ ì½œë°±í•¨ìˆ˜ ìˆ˜í–‰

##### `await í”„ë¡œë¯¸ìŠ¤ê°ì²´` ëŠ” ì™„ë£Œëœ ê°’ì„ ë°˜í™˜í•œë‹¤

â—ï¸ì—¬ê¸°ì„œ ì•Œ ìˆ˜ ìˆëŠ” íŠ¹ì´ì‚¬í•­ì€ **`await í”„ë¡œë¯¸ìŠ¤ê°ì²´` ë¡œ ë°›ëŠ” ê°’ì€** í”„ë¡œë¯¸ìŠ¤ê°ì²´ê°€ ìµœì¢…ì ìœ¼ë¡œ **Fullfilled ëœ ê°’**ì´ë‹¤.

**\* ê·¸ëƒ¥ ê°’ì´ì§€ Promise ê°ì²´ê°€ ì•„ë‹˜!** (async functionê³¼ í˜¼ë™í•˜ì§€ ë§ì)

> ì´ ë§ì€ ìš°ë¦¬ê°€ Promiseì—ì„œ ê²°ê³¼ë¥¼ ì–»ìœ¼ë ¤ë©´ then() ë©”ì†Œë“œì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ë„˜ê²¨ì•¼í–ˆë˜ ê²ƒì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ë§.

### ì§ë ¬, ë³‘ë ¬ ì²˜ë¦¬

ì´ async / await ì—ì„œ ë‚´ê°€ ê°€ì¥ ì¢‹ê² ë‹¤ê³  ìƒê°í•œ ì ì€ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì„ ë™ê¸° í”„ë¡œê·¸ë˜ë°ê³¼ ê°™ì€ ê°€ë…ì„±ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ì ë„ ìˆì§€ë§Œ,

async function ë‚´ë¶€ì—ì„œ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° ì§ë ¬, ë³‘ë ¬ ìˆ˜í–‰ì„ ì‰½ê³  ì›í•˜ëŠ”ëŒ€ë¡œ í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì¸ ê²ƒ ê°™ë‹¤.



#### ì§ë ¬ ìˆ˜í–‰

ë‹¤ìŒê³¼ ê°™ì´ ì§ë ¬ ìˆ˜í–‰ì„ í•  ìˆ˜ë„ ìˆê³ 

```js
function resolveAfter2Seconds(x) {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(x);
    }, 2000);
  });
}

async function add1(x) {
  const a = await resolveAfter2Seconds(20);
  console.log("a", a); // 2ì´ˆ ë’¤ a 20 ì¶œë ¥
  const b = await resolveAfter2Seconds(30);
  console.log("b", b); // 4ì´ˆ ë’¤ a 30 ì¶œë ¥
  return x + a + b;
}

add1(10).then((v) => {
  console.log(v); // 50 ì¶œë ¥
});

console.log("finish");
```

ì˜ˆì œ ì°¸ì¡° : [vanilla coding - bootCamp 9 1ì£¼ì°¨ ìˆ˜ì—…](https://www.vanillacoding.co/)



```js
function bar () {
  return new Promise(function (resolve, reject) {
    setTimeout(function () {
      resolve(666);
    }, 1000);
  });
}

function foo () {
  return new Promise(function (resolve, reject) {
    setTimeout(function () {
      resolve(777);
    }, 1000);
  });
}

async function process2() {
  return (await foo()) + (await bar()); // 666 + 777
}

process2();
```

ì˜ˆì œ ì°¸ì¡° : [vanilla coding - bootCamp 9 1ì£¼ì°¨ ìˆ˜ì—…](https://www.vanillacoding.co/)



ë‹¤ìŒê³¼ ê°™ì´ ì§ë ¬ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.



#### ë³‘ë ¬ì²˜ë¦¬

ë³‘ë ¬ì²˜ë¦¬ëŠ” `await`í‚¤ì›Œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ì „ì— Promiseê°ì²´ë¥¼ ìƒì„±í•´ì„œ ë¯¸ë¦¬ ë¹„ë™ê¸° ì‘ì—…ì„ pendingì‹œì¼œë†“ê³  ì´ pendingìƒíƒœì˜ í”„ë¡œë¯¸ìŠ¤ê°ì²´ë¥¼ `await` í•˜ë©´ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

```js{11-12}
function resolveAfter2Seconds(x) {
  return new Promise(function foo (resolve) {
    setTimeout(() => {
      resolve(x);
    }, 2000);
  });
}

// Async/Await Example #3
async function add2(x) {
  const a = resolveAfter2Seconds(20);
  const b = resolveAfter2Seconds(30);
  return x + (await a) + (await b);
}

add2(10).then((v) => {
  console.log(v);
});
```



## ì°¸ì¡°

[VanillaCoding - BootCamp ê°•ì˜ - Asynchronous](https://www.vanillacoding.co/)

[MDN - ì¼ë°˜ì ì¸ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë° ê°œë…](https://developer.mozilla.org/ko/docs/Learn/JavaScript/Asynchronous/Concepts)

[MDN - Promise](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/Promise)

[MDN - Async Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function)

[ìº¡í‹´íŒêµë‹˜ì˜ ë¹„ë™ê¸°ì²˜ë¦¬](https://joshua1988.github.io/web-development/javascript/javascript-asynchronous-operation/)

[ìº¡í‹´íŒêµë‹˜ì˜ Promise](https://joshua1988.github.io/web-development/javascript/promise-for-beginners/)

[ìº¡í‹´íŒêµë‹˜ì˜ Async/Await](https://joshua1988.github.io/web-development/javascript/js-async-await/)

[Poimaweb - ë¹„ë™ê¸°](https://poiemaweb.com/js-async)

